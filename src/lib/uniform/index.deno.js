var St=Object.create;var je=Object.defineProperty;var bt=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Ct=Object.getPrototypeOf,Et=Object.prototype.hasOwnProperty;var Ge=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var It=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Dt(t))!Et.call(e,s)&&s!==n&&je(e,s,{get:()=>t[s],enumerable:!(i=bt(t,s))||i.enumerable});return e};var L=(e,t,n)=>(n=e!=null?St(Ct(e)):{},It(t||!e||!e.__esModule?je(n,"default",{value:e,enumerable:!0}):n,e));var le=Ge((jn,Me)=>{"use strict";Me.exports=xt;function Q(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}function xt(e){if(e=e||{},e.circles)return Tt(e);return e.proto?i:n;function t(s,a){for(var r=Object.keys(s),o=new Array(r.length),u=0;u<r.length;u++){var l=r[u],d=s[l];typeof d!="object"||d===null?o[l]=d:d instanceof Date?o[l]=new Date(d):ArrayBuffer.isView(d)?o[l]=Q(d):o[l]=a(d)}return o}function n(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return t(s,n);if(s instanceof Map)return new Map(t(Array.from(s),n));if(s instanceof Set)return new Set(t(Array.from(s),n));var a={};for(var r in s)if(Object.hasOwnProperty.call(s,r)!==!1){var o=s[r];typeof o!="object"||o===null?a[r]=o:o instanceof Date?a[r]=new Date(o):o instanceof Map?a[r]=new Map(t(Array.from(o),n)):o instanceof Set?a[r]=new Set(t(Array.from(o),n)):ArrayBuffer.isView(o)?a[r]=Q(o):a[r]=n(o)}return a}function i(s){if(typeof s!="object"||s===null)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return t(s,i);if(s instanceof Map)return new Map(t(Array.from(s),i));if(s instanceof Set)return new Set(t(Array.from(s),i));var a={};for(var r in s){var o=s[r];typeof o!="object"||o===null?a[r]=o:o instanceof Date?a[r]=new Date(o):o instanceof Map?a[r]=new Map(t(Array.from(o),i)):o instanceof Set?a[r]=new Set(t(Array.from(o),i)):ArrayBuffer.isView(o)?a[r]=Q(o):a[r]=i(o)}return a}}function Tt(e){var t=[],n=[];return e.proto?a:s;function i(r,o){for(var u=Object.keys(r),l=new Array(u.length),d=0;d<u.length;d++){var f=u[d],v=r[f];if(typeof v!="object"||v===null)l[f]=v;else if(v instanceof Date)l[f]=new Date(v);else if(ArrayBuffer.isView(v))l[f]=Q(v);else{var g=t.indexOf(v);g!==-1?l[f]=n[g]:l[f]=o(v)}}return l}function s(r){if(typeof r!="object"||r===null)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return i(r,s);if(r instanceof Map)return new Map(i(Array.from(r),s));if(r instanceof Set)return new Set(i(Array.from(r),s));var o={};t.push(r),n.push(o);for(var u in r)if(Object.hasOwnProperty.call(r,u)!==!1){var l=r[u];if(typeof l!="object"||l===null)o[u]=l;else if(l instanceof Date)o[u]=new Date(l);else if(l instanceof Map)o[u]=new Map(i(Array.from(l),s));else if(l instanceof Set)o[u]=new Set(i(Array.from(l),s));else if(ArrayBuffer.isView(l))o[u]=Q(l);else{var d=t.indexOf(l);d!==-1?o[u]=n[d]:o[u]=s(l)}}return t.pop(),n.pop(),o}function a(r){if(typeof r!="object"||r===null)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return i(r,a);if(r instanceof Map)return new Map(i(Array.from(r),a));if(r instanceof Set)return new Set(i(Array.from(r),a));var o={};t.push(r),n.push(o);for(var u in r){var l=r[u];if(typeof l!="object"||l===null)o[u]=l;else if(l instanceof Date)o[u]=new Date(l);else if(l instanceof Map)o[u]=new Map(i(Array.from(l),a));else if(l instanceof Set)o[u]=new Set(i(Array.from(l),a));else if(ArrayBuffer.isView(l))o[u]=Q(l);else{var d=t.indexOf(l);d!==-1?o[u]=n[d]:o[u]=a(l)}}return t.pop(),n.pop(),o}}});var $e=Ge(ze=>{"use strict";ze.parse=fn;ze.serialize=hn;var dn=Object.prototype.toString,Ce=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function fn(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var n={},i=t||{},s=i.decode||pn,a=0;a<e.length;){var r=e.indexOf("=",a);if(r===-1)break;var o=e.indexOf(";",a);if(o===-1)o=e.length;else if(o<r){a=e.lastIndexOf(";",r-1)+1;continue}var u=e.slice(a,r).trim();if(n[u]===void 0){var l=e.slice(r+1,o).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),n[u]=mn(l,s)}a=o+1}return n}function hn(e,t,n){var i=n||{},s=i.encode||vn;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!Ce.test(e))throw new TypeError("argument name is invalid");var a=s(t);if(a&&!Ce.test(a))throw new TypeError("argument val is invalid");var r=e+"="+a;if(i.maxAge!=null){var o=i.maxAge-0;if(isNaN(o)||!isFinite(o))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(o)}if(i.domain){if(!Ce.test(i.domain))throw new TypeError("option domain is invalid");r+="; Domain="+i.domain}if(i.path){if(!Ce.test(i.path))throw new TypeError("option path is invalid");r+="; Path="+i.path}if(i.expires){var u=i.expires;if(!gn(u)||isNaN(u.valueOf()))throw new TypeError("option expires is invalid");r+="; Expires="+u.toUTCString()}if(i.httpOnly&&(r+="; HttpOnly"),i.secure&&(r+="; Secure"),i.partitioned&&(r+="; Partitioned"),i.priority){var l=typeof i.priority=="string"?i.priority.toLowerCase():i.priority;switch(l){case"low":r+="; Priority=Low";break;case"medium":r+="; Priority=Medium";break;case"high":r+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(i.sameSite){var d=typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite;switch(d){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return r}function pn(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function vn(e){return encodeURIComponent(e)}function gn(e){return dn.call(e)==="[object Date]"||e instanceof Date}function mn(e,t){try{return t(e)}catch(n){return e}}});var Fe=Object.prototype.hasOwnProperty;function x(e,t){var n,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((i=e.length)===t.length)for(;i--&&x(e[i],t[i]););return i===-1}if(!n||typeof e=="object"){i=0;for(n in e)if(Fe.call(e,n)&&++i&&!Fe.call(t,n)||!(n in t)||!x(e[n],t[n]))return!1;return Object.keys(t).length===i}}return e!==e&&t!==t}function ae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var kt={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Ee(e,t){function n(s,a,r){if(typeof document!="undefined"){r=ae({},t,r),typeof r.expires=="number"&&(r.expires=new Date(Date.now()+r.expires*864e5)),r.expires&&(r.expires=r.expires.toUTCString()),s=encodeURIComponent(s).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var u in r)r[u]&&(o+="; "+u,r[u]!==!0&&(o+="="+r[u].split(";")[0]));return document.cookie=s+"="+e.write(a,s)+o}}function i(s){if(!(typeof document=="undefined"||arguments.length&&!s)){for(var a=document.cookie?document.cookie.split("; "):[],r={},o=0;o<a.length;o++){var u=a[o].split("="),l=u.slice(1).join("=");try{var d=decodeURIComponent(u[0]);if(r[d]=e.read(l,d),s===d)break}catch(f){}}return s?r[s]:r}}return Object.create({set:n,get:i,remove:function(s,a){n(s,"",ae({},a,{expires:-1}))},withAttributes:function(s){return Ee(this.converter,ae({},this.attributes,s))},withConverter:function(s){return Ee(ae({},this.converter,s),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var oe=Ee(kt,{path:"/"});function K(e){return{all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map(function(s){s(n)}),(i=e.get("*"))&&i.slice().map(function(s){s(t,n)})}}}var ut=L(le(),1);var ht=L(le(),1),pt=L(le(),1),Ot=Object.defineProperty,Je=e=>{throw TypeError(e)},At=(e,t,n)=>t in e?Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F=(e,t,n)=>At(e,typeof t!="symbol"?t+"":t,n),Re=(e,t,n)=>t.has(e)||Je("Cannot "+n),c=(e,t,n)=>(Re(e,t,"read from private field"),n?n.call(e):t.get(e)),_=(e,t,n)=>t.has(e)?Je("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),S=(e,t,n,i)=>(Re(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),D=(e,t,n)=>(Re(e,t,"access private method"),n);function Rt(e,t){let n={...e};for(let i in t){let s=Xe(e,i,t,new Set([i]));s!==0&&(n[i]=s)}return n}function Xe(e,t,n,i){var s;let a=0;for(let r of n[t].inputs){let o=(s=e[r.dim])!=null?s:0;if(!o&&n[r.dim]){if(i.has(r.dim))continue;let l=new Set(i);l.add(r.dim),o=Xe(e,r.dim,n,l)}if(o!==0)if(r.sign==="c"){a=0;break}else r.sign==="-"?a-=o:a+=o}return a}var Se="_",xe,J,Ut=class{constructor(e){_(this,xe),_(this,J),S(this,J,e.id),S(this,xe,e.signal)}get id(){return c(this,J)}evaluate({scores:e,quirks:t}){let n=e==null?void 0:e[c(this,J)],i=`goal_${c(this,J)}_triggered`,s=(t==null?void 0:t[i])==="1";return{key:i,triggered:typeof n=="number"&&!s}}};xe=new WeakMap;J=new WeakMap;var ue,ce,Pt=class{constructor(e,t,n){_(this,ue),_(this,ce),F(this,"signal"),this.signal=e,S(this,ue,t),S(this,ce,n)}computeSignal(e,t){if(e.scores[this.signal.id]>=this.signal.cap&&this.signal.dur!=="t")return;let i=c(this,ue).evaluate(e,this.signal.crit,t,this.signal,c(this,ce)),s=this.signal.dur==="s"||this.signal.dur==="t"?"modscoreS":"modscore";if(i.changed){if(i.result)t.push({type:s,data:{dimension:this.signal.id,delta:this.signal.str}});else if(this.signal.dur==="t"){let a=e.visitor.sessionScores[this.signal.id];a&&t.push({type:s,data:{dimension:this.signal.id,delta:-a}})}}}};ue=new WeakMap;ce=new WeakMap;var Le=e=>{let t=e;return t>=1&&(t=t/100),Math.random()<t},$,de,fe,M,Nt=class{constructor({manifest:e,evaluator:t=new tt({}),onLogMessage:n=()=>{}}){F(this,"data"),_(this,$),_(this,de),_(this,fe,[]),_(this,M);var i,s,a,r,o;S(this,$,(i=e.project)!=null?i:{}),this.data=e,S(this,de,Object.entries((a=(s=c(this,$).pz)==null?void 0:s.sig)!=null?a:[]).map(([u,l])=>new Pt({...l,id:u},t,n))),Object.entries((o=(r=c(this,$).pz)==null?void 0:r.sig)!=null?o:[]).forEach(([u,l])=>{l.conversion&&c(this,fe).push(new Ut({id:u,signal:l}))}),S(this,M,n)}rollForControlGroup(){var e;return Le(((e=c(this,$).pz)==null?void 0:e.control)||0)}getTest(e){var t;return(t=c(this,$).test)==null?void 0:t[e]}computeSignals(e){let t=[];c(this,M).call(this,["debug",200,"GROUP"]);try{c(this,de).forEach(n=>{c(this,M).call(this,["debug",201,"GROUP",n.signal]);try{n.computeSignal(e,t)}finally{c(this,M).call(this,["debug",201,"ENDGROUP"])}})}finally{c(this,M).call(this,["debug",200,"ENDGROUP"])}return t}computeGoals(e){let t=[];return c(this,fe).forEach(n=>{let{triggered:i,key:s}=n.evaluate(e);i&&(t.push({type:"setgoal",data:{goal:n.id}}),t.push({type:"setquirk",data:{key:s,value:"1"}}))}),t}computeAggregateDimensions(e){var t,n;return Rt(e,(n=(t=c(this,$).pz)==null?void 0:t.agg)!=null?n:{})}getDimensionByKey(e){var t,n,i,s;let a=e.indexOf(Se);return a<=0?(n=(t=c(this,$).pz)==null?void 0:t.sig)==null?void 0:n[e]:(s=(i=c(this,$).pz)==null?void 0:i.enr)==null?void 0:s[e.substring(0,a)]}};$=new WeakMap;de=new WeakMap;fe=new WeakMap;M=new WeakMap;function ie(e,t){var n,i,s,a,r,o;let u=(n=t==null?void 0:t.op)!=null?n:"=";if(t.op==="*")return e!==null&&typeof e!="undefined";if(t.op==="!*")return e===null||typeof e=="undefined";if(!("rhs"in t))throw new Error(`Match expression is required for match type ${u}`);let l=(i=t.cs)!=null?i:!1,d=(l?e!=null?e:"":qe(e)).toString(),f=(l?t.rhs:qe(t.rhs)).toString();switch(u){case"=":return d===f;case"!=":return d!==f;case"~":return(s=d.includes(f))!=null?s:!1;case"!~":return!((a=d.includes(f))==null||a);case"//":return new RegExp(t.rhs.toString(),l?"":"i").test((r=e==null?void 0:e.toString())!=null?r:"");case"!//":return!new RegExp(t.rhs.toString(),l?"":"i").test((o=e==null?void 0:e.toString())!=null?o:"");default:throw new Error(`Unknown match type ${u}.`)}}function De(e,t){return`'${("cs"in t?t.cs:!1)?e:e==null?void 0:e.toString().toUpperCase()}' ${Ye(t)}`}function Ye(e){return"rhs"in e?`${e.op} '${e.cs?e.rhs:e.rhs.toString().toUpperCase()}'`:`${e.op==="*"?"exists":"does not exist"}`}function qe(e){var t,n;return(n=(t=e==null?void 0:e.toString())==null?void 0:t.toUpperCase())!=null?n:""}var zt=({update:e,criteria:t,onLogMessage:n})=>{var i,s;if(t.type!=="CK")return{result:!1,changed:!1};let a=!x(We(e.state.cookies),We((i=e.previousState)==null?void 0:i.cookies)),r=(s=e.state.cookies)==null?void 0:s[t.cookieName],u={result:ie(r,t.match),changed:a};return n==null||n(["debug",203,{criteria:t,result:u,explanation:De(r,t.match)}]),u};function We(e){if(!e)return;if(!e.ufvd)return e;let{ufvd:t,...n}=e;return n}var $t=({update:e,criteria:t,onLogMessage:n})=>{var i,s,a;if(t.type!=="PV")return{result:!1,changed:!1};let r=(i=e.state.url)==null?void 0:i.pathname,o=!e.previousState||(r==null?void 0:r.toString())!==((a=(s=e.previousState.url)==null?void 0:s.pathname)==null?void 0:a.toString()),l={result:ie(r,t.path),changed:o};return n==null||n(["debug",203,{criteria:t,result:l,explanation:De(r,t.path)}]),l},Vt=({update:e,criteria:t,onLogMessage:n})=>{var i,s,a;if(t.type!=="EVT")return{result:!1,changed:!1};let r=(s=(i=e.state.events)==null?void 0:i.some(u=>ie(u.event,t.event)))!=null?s:!1,o={result:r,changed:r};return n==null||n(["debug",203,{criteria:t,result:o,explanation:`'${(a=e.state.events)==null?void 0:a.join("', '")}' ${Ye(t.event)}`}]),o};function Ze(e,t){return`${e}${Se}${t}`}function jt(e,t){var n;if(typeof e=="undefined"||e===null)return!1;let i=Number(e);if(isNaN(i))return!1;switch((n=t==null?void 0:t.op)!=null?n:"="){case"=":return i===t.rhs;case"!=":return i!==t.rhs;case">":return i>t.rhs;case"<":return i<t.rhs;default:return console.warn(`Unknown match type ${t.op} is false.`),!1}}function Gt(e,t){return`${e} ${Ft(t)}`}function Ft(e){return`${e.op} ${e.rhs}`}var Ie=Ze("$pvc","v"),et=({update:e,criteria:t,commands:n,onLogMessage:i})=>{var s,a;if(t.type!=="PVC")return{result:!1,changed:!1};let r=!!(e.state.url&&(!e.previousState||((s=e.state.url)==null?void 0:s.toString())!==((a=e.previousState.url)==null?void 0:a.toString()))),u=(e.visitor.sessionScores[Ie]||0)+1,l={result:!1,changed:r},d=n.some(f=>f.type==="modscoreS"&&f.data.dimension===Ie);return r&&!d&&n.push({type:"modscoreS",data:{dimension:Ie,delta:1}}),jt(u,t.match)&&(l.result=!0),i==null||i(["debug",203,{criteria:t,result:l,explanation:Gt(u,t.match)}]),l};et.alwaysExecute=!0;var Mt=({update:e,criteria:t,onLogMessage:n})=>{var i,s,a,r,o;if(t.type!=="QS")return{result:!1,changed:!1};let u=!e.previousState||((s=(i=e.state.url)==null?void 0:i.searchParams)==null?void 0:s.toString())!==((r=(a=e.previousState.url)==null?void 0:a.searchParams)==null?void 0:r.toString()),l=(o=e.state.url)==null?void 0:o.searchParams.get(t.queryName),f={result:ie(l,t.match),changed:u};return n==null||n(["debug",203,{criteria:t,result:f,explanation:De(l,t.match)}]),f},qt=({update:e,criteria:t,signal:n,onLogMessage:i})=>{var s;if(t.type!=="QK")return{result:!1,changed:!1};if(typeof document=="undefined"&&e.scores[n.id]>0)return{result:!0,changed:!1};let a=e.visitor.quirks[t.key],r=(s=e.state.quirks)==null?void 0:s[t.key],o=r!=null?r:a,u=!!(r&&a!==r),d={result:ie(o,t.match),changed:u};return i==null||i(["debug",203,{criteria:t,result:d,explanation:De(o,t.match)}]),d},he,tt=class{constructor(e){_(this,he),S(this,he,e)}evaluate(e,t,n,i,s){let a=t.clauses.length>1;a&&(s==null||s(["debug",202,"GROUP",t]));try{let r=!(t.op==="&"||!t.op),o=null,u=!1;for(let d of t.clauses){let f;if(d.type==="G")f=this.evaluate(e,d,n,i,s);else{let v=c(this,he)[d.type];if(o&&!v.alwaysExecute)continue;if(!v)throw new Error(`${d.type} signal criteria not registered`);f=v({update:e,criteria:d,commands:n,signal:i,onLogMessage:s})}f.changed&&(u=!0),!o&&f.result===r&&(o={result:r,changed:u})}let l=o!=null?o:{result:!r,changed:u};return a&&(s==null||s(["debug",204,l])),l}finally{a&&(s==null||s(["debug",202,"ENDGROUP"]))}}};he=new WeakMap;function Wt(e,t,n,i){i==null||i(["info",301,"GROUP",{id:e,op:t==null?void 0:t.op}]);let s;try{t!=null&&t.crit?!t.op||t.op==="&"?s=t.crit.every(a=>Be(a,n,i)):s=t.crit.some(a=>Be(a,n,i)):(i==null||i(["info",302,{matched:!0,description:"default variation"}]),s=!0),i==null||i(["info",303,s])}finally{i==null||i(["info",301,"ENDGROUP"])}return s}function Be(e,t,n){var i,s;let{op:a,l:r}=e,o=(i=t[r])!=null?i:0;if(a==="^"){let[l]=r.split(Se),d,f=0;Object.keys(t).forEach(g=>{if(g.startsWith(`${l}${Se}`)){let p=t[g];p>f&&(d=g,f=p)}});let v=d===r;return n==null||n(["info",302,{matched:v,description:`${e.l} has the highest score in the category`}]),v}else if(a==="+"){let l=Math.max(...Object.values(t))===o&&o>0;return n==null||n(["info",302,{matched:l,description:`${e.l} has the highest score`}]),l}else if(a==="-"){let l=Math.min(...Object.values(t))===o&&o>0;return n==null||n(["info",302,{matched:l,description:`${e.l} has the lowest non-zero score`}]),l}let u;if(e.rDim?u=t[e.rDim]||0:u=parseInt(e.r,10),isNaN(u))return n==null||n(["info",302,{matched:!1,description:`${(s=e.rDim)!=null?s:e.r} has no score value`}]),!1;if(a===">"){let l=o>u;return H(n,l,e,o,u),l}else if(a===">="){let l=o>=u;return H(n,l,e,o,u),l}else if(a==="<"){let l=o<u;return H(n,l,e,o,u),l}else if(a==="<="){let l=o<=u;return H(n,l,e,o,u),l}else if(a==="="){let l=o===u;return H(n,l,e,o,u),l}else if(a==="!="){let l=o!==u;return H(n,l,e,o,u),l}else throw new Error(`Unknown op: ${a}`)}function H(e,t,n,i,s){e==null||e(["info",302,{matched:t,description:`${n.l}[${i}] ${n.op} ${n.rDim?`${n.rDim}[${s}]`:n.r}`}])}function Bt({name:e,context:t,variations:n,take:i=1,onLogMessage:s}){var a,r,o,u;s==null||s(["info",300,"GROUP",{name:e,take:i}]);try{let l=(a=t.storage.data.controlGroup)!=null?a:!1,d=[],f=!1,v=t.scores,g=0,p=[];for(let h of n)(r=h.pz)!=null&&r.crit.length||p.push(h);for(let h of n){let y=g++;if(d.length===i)break;if(!((o=h.pz)!=null&&o.crit.length)){s==null||s(["info",301,"GROUP",{id:h.id,op:(u=h.pz)==null?void 0:u.op}]),s==null||s(["info",302,{matched:!0,description:"default variation"}]),s==null||s(["info",303,!0]),s==null||s(["info",301,"ENDGROUP"]),d.push({...h,control:!1});continue}if(!l&&Wt(h.id,h.pz,v,s)){let I=h,m=!1,N=p.find(w=>w.id===h.id);i===1&&!N&&p.length&&typeof h.pz.control=="number"&&(m=t.getPersonalizeVariantControl(e,y),typeof m=="undefined"&&(m=Le(h.pz.control),t.storage.updateData([{type:"setpersonalizecontrol",data:{personlizationName:e,index:y,control:m}}])),m&&(I={...p[0],id:h.id})),f=f||typeof I.pz!="undefined",d.push({...I,control:m})}}return{personalized:f,variations:d}}finally{s==null||s(["info",300,"ENDGROUP"])}}var Kt=e=>{let{values:t,total:n,missingDistribution:i}=e.reduce((s,a)=>(a.testDistribution?s.total+=a.testDistribution:++s.missingDistribution,s.values.push(a.testDistribution),s),{values:[],total:0,missingDistribution:0});if(n>100)throw new Error(`Total distribution ${n} is over the maximum 100.`);if(n<100){let a=(100-n)/i;t.forEach((r,o)=>{typeof r=="undefined"&&(t[o]=a)})}return t},Qt=({name:e,context:t,variations:n,onLogMessage:i})=>{i==null||i(["info",400,"GROUP",e]);try{let s,a=t.getTestVariantId(e);if(a===null)return i==null||i(["error",401,e]),{result:void 0,variantAssigned:!1};if(a&&(s=n.find(r=>r.id===a),s||i==null||i(["warn",402,{missingVariant:a,variants:n.map(r=>r.id)}])),!s){let r=Kt(n),o=Math.floor(Math.random()*100),u=0;s=n.find((l,d)=>{let f=r[d];if(o>u&&o<=u+f)return l;u+=f}),s&&(i==null||i(["info",403,s.id]),t.setTestVariantId(e,s.id))}return s&&(i==null||i(["info",404,s.id])),{result:s,variantAssigned:!a}}finally{i==null||i(["info",400,"ENDGROUP"])}},Ht=(e,t)=>e.type!==t.type?!1:x(e,t),Jt="__UNIFORM_DATA__",q,pe,Y,Xt=class{constructor({initialData:e}){_(this,q),_(this,pe),_(this,Y,K()),F(this,"events",{on:c(this,Y).on,off:c(this,Y).off}),e&&(S(this,q,e),S(this,pe,e))}get data(){return c(this,q)}get initialData(){return c(this,pe)}updateData(e,t){return S(this,q,t),this.handleUpdateData(e,t)}async delete(e){S(this,q,void 0),await this.handleDelete(e)}signalAsyncDataUpdate(e){x(this.data,e)||(S(this,q,e),c(this,Y).emit("dataUpdatedAsync",e))}getClientTransitionState(){if(typeof document=="undefined")return;let e=document.getElementById(Jt);return e!=null&&e.textContent?JSON.parse(e.textContent):void 0}};q=new WeakMap;pe=new WeakMap;Y=new WeakMap;var Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ke=Te.split(""),nt=new Array(123);for(let e=0;e<Te.length;e++)nt[Te.charCodeAt(e)]=e;var it=e=>{if(e<0)return`-${it(-e)}`;let t=e>>>0,n=e/4294967296>>>0,i="";for(;n>0;)i=Ke[63&t]+i,t>>>=6,t|=(63&n)<<26,n>>>=6;let s="";do s=Ke[63&t]+s,t>>>=6;while(t>0);return s+i},Lt=e=>{let t=0,n=e.charAt(0)==="-"?1:0;for(let i=n;i<e.length;i++)t=t*64+nt[e.charCodeAt(i)];return n?-t:t},ke=typeof document=="undefined",Ue="ufvd",X,ve,st=class extends Xt{constructor({serverCookieValue:e,cookieName:t=Ue,cookieAttributes:n={sameSite:"lax"}}){super({initialData:ke?Yt(e):void 0}),_(this,X),_(this,ve),S(this,X,t),S(this,ve,n)}handleDelete(){return ke||oe.remove(c(this,X)),Promise.resolve()}async handleUpdateData(e,t){ke||(t.consent?oe.set(c(this,X),Zt(t),c(this,ve)):oe.remove(c(this,X)))}};X=new WeakMap;ve=new WeakMap;var rt="~",at="!",ot="-";function Yt(e){if(!e)return;let t=e.split(rt);if(t.length>5)return;let[n,i,s,a,r]=t;return{consent:!0,sessionScores:Qe(ge(i)),scores:Qe(ge(s)),tests:ge(n),controlGroup:a==="1",personalizeVariants:tn(r)}}function ge(e){return e?e.split(at).map(n=>n.split(ot)).reduce((n,i)=>(i.length<2||(n[i[0]]=i.slice(1).join("-")),n),{}):{}}function Qe(e){return Object.entries(e).reduce((t,[n,i])=>(t[n]=Lt(i),t),{})}function Zt(e){return[me(e.tests),me(He(e.sessionScores)),me(He(e.scores)),e.controlGroup?"1":"0",en(e)].join(rt)}function en({personalizeVariants:e}){let t={};return typeof e=="object"&&Object.keys(e).forEach(i=>{let s=[];e[i].forEach(r=>{s.push(`${r.index}:${r.control?"1":"0"}`)}),t[i]=s.join(",")}),me(t)}function tn(e){let t=ge(e);if(!Object.keys(t).length)return;let i={};return Object.keys(t).forEach(s=>{let a=t[s].split(","),r=decodeURIComponent(s);i[r]=a.map(o=>{let[u,l]=o.split(":");return{index:parseInt(u,10),control:l==="1"}})}),i}function He(e){return Object.entries(e).reduce((t,[n,i])=>(t[n]=it(i),t),{})}function me(e){return Object.entries(e).map(t=>t.join(ot)).join(at)}var nn,sn;nn=new WeakSet;sn=async function(){let e=await new Promise(t=>{setTimeout(()=>{t(void 0)},2e3)});e&&this.signalAsyncDataUpdate(e)};var lt=()=>({quirks:{},scores:{},sessionScores:{},tests:{},goals:{},consent:!1,controlGroup:!1,personalizeVariants:{}}),rn=(0,ut.default)();function an(e,t,n){let i=t?rn(t):lt();return e.forEach(s=>{var a,r,o;switch(s.type){case"consent":i.consent=s.data;break;case"setquirk":i.quirks[s.data.key]=s.data.value;break;case"settest":i.tests[s.data.test]=s.data.variant;break;case"modscore":if(n)break;let u=Number(s.data.delta);if(isNaN(u))throw new Error("Non-number delta received");let l=(a=i.scores[s.data.dimension])!=null?a:0;i.scores[s.data.dimension]=l+u;break;case"modscoreS":if(n)break;let d=Number(s.data.delta);if(isNaN(d))throw new Error("Non-number delta received");let f=(r=i.sessionScores[s.data.dimension])!=null?r:0;i.sessionScores[s.data.dimension]=f+d;break;case"identify":break;case"setcontrol":i.controlGroup=s.data;break;case"setpersonalizecontrol":i.personalizeVariants||(i.personalizeVariants={}),i.personalizeVariants[s.data.personlizationName]||(i.personalizeVariants[s.data.personlizationName]=[]),i.personalizeVariants[s.data.personlizationName].find(g=>g.index===s.data.index)?console.warn("Overwriting existing control group definition is not allowed"):i.personalizeVariants[s.data.personlizationName].push({index:s.data.index,control:s.data.control});break;case"setgoal":i.goals=(o=i.goals)!=null?o:{},i.goals[s.data.goal]=!0;break;default:throw new Error("Unknown command")}}),i}var Z,ye,on=class{constructor(e){this.partitionKey=e,_(this,Z),F(this,"inMemoryFallback",{}),F(this,"hasLocalStorageObject",typeof localStorage!="undefined")}get(e){let t=D(this,Z,ye).call(this,e),n=this.inMemoryFallback[t];if(!this.hasLocalStorageObject||n)return n;try{let i=localStorage.getItem(t);return i?JSON.parse(i):void 0}catch(i){return n}}set(e,t,n){let i=D(this,Z,ye).call(this,e);if(this.inMemoryFallback[i]=t,!(!this.hasLocalStorageObject||!n))try{localStorage.setItem(i,JSON.stringify(t))}catch(s){console.warn(s)}}delete(e,t){let n=D(this,Z,ye).call(this,e);t||delete this.inMemoryFallback[n];try{localStorage.removeItem(n)}catch(i){}}};Z=new WeakSet;ye=function(e){return this.partitionKey?`${this.partitionKey}.${e}`:e};var be="ufvisitor",P,B,ne,C,E,G,W,ct,dt,Oe,Ae,ln=class{constructor(e){if(_(this,E),_(this,P,K()),_(this,B),_(this,ne),_(this,C),F(this,"events",{on:c(this,P).on,off:c(this,P).off}),S(this,C,e),S(this,B,new on(e.partitionKey)),c(this,E,G)||D(this,E,W).call(this,D(this,E,Ae).call(this),!0),e.transitionStore){let t=e.transitionStore.getClientTransitionState();t&&e.onServerTransitionReceived&&e.onServerTransitionReceived(t),e.transitionStore.events.on("dataUpdatedAsync",i=>{D(this,E,W).call(this,{...c(this,E,G).visitorData,...i})});let n=e.transitionStore.data;n&&D(this,E,W).call(this,{...c(this,E,G).visitorData,...n},!0)}}get data(){var e,t;let n=c(this,E,G);if(D(this,E,dt).call(this,n)){let{sessionScores:i,...s}=n.visitorData;return D(this,E,W).call(this,{...s,sessionScores:{}}),(t=(e=c(this,C)).onLogMessage)==null||t.call(e,["info",120]),c(this,E,G).visitorData}return n.visitorData}get decayEnabled(){return!!c(this,C).decay}get options(){return c(this,C)}async updateData(e){var t,n,i,s;if(e.length===0)return;(n=(t=c(this,C)).onLogMessage)==null||n.call(t,["debug",101,e]);let a=an(e,this.data,(i=c(this,E,G))==null?void 0:i.visitorData.controlGroup);e.some(r=>r.type==="consent"&&!r.data)&&c(this,B).delete(be,!0),D(this,E,W).call(this,a),await((s=c(this,C).transitionStore)==null?void 0:s.updateData(e,c(this,E,G).visitorData)),c(this,P).emit("commandsExecuted",e)}async delete(e){var t,n,i,s,a;(n=(t=c(this,C)).onLogMessage)==null||n.call(t,["info",103,"GROUP",e]);try{c(this,B).delete(be,!1),await((i=c(this,C).transitionStore)==null?void 0:i.delete(e)),D(this,E,W).call(this,D(this,E,Ae).call(this))}finally{(a=(s=c(this,C)).onLogMessage)==null||a.call(s,["info",103,"ENDGROUP"])}}};P=new WeakMap;B=new WeakMap;ne=new WeakMap;C=new WeakMap;E=new WeakSet;G=function(){return c(this,B).get(be)};W=function(e,t=!1){var n,i,s,a,r,o,u,l,d,f,v;let g=c(this,E,G),p=Date.now();e.controlGroup?(e.scores={},e.sessionScores={}):(D(this,E,Oe).call(this,e.scores),D(this,E,Oe).call(this,e.sessionScores),(i=(n=c(this,C)).decay)==null||i.call(n,{now:p,lastUpd:g==null?void 0:g.updated,scores:e.scores,sessionScores:e.sessionScores,onLogMessage:c(this,C).onLogMessage}));let h=!x(g==null?void 0:g.visitorData.scores,e.scores),y=!x(g==null?void 0:g.visitorData.sessionScores,e.sessionScores),I=!x(g==null?void 0:g.visitorData.quirks,e.quirks),m=!x(g==null?void 0:g.visitorData.tests,e.tests),N=!x(g==null?void 0:g.visitorData.goals,e.goals),w={updated:p,visitorData:e};if(D(this,E,ct).call(this),c(this,B).set(be,w,!!e.consent),(a=(s=c(this,C)).onLogMessage)==null||a.call(s,["debug",102,e]),!t&&((h||y)&&c(this,P).emit("scoresUpdated",e),I&&c(this,P).emit("quirksUpdated",e),m&&c(this,P).emit("testsUpdated",e),((r=g==null?void 0:g.visitorData)==null?void 0:r.consent)!==e.consent&&c(this,P).emit("consentUpdated",e),((o=g==null?void 0:g.visitorData)==null?void 0:o.controlGroup)!==e.controlGroup&&(c(this,P).emit("controlGroupUpdated",e),(d=(l=c(this,C)).onLogMessage)==null||d.call(l,["debug",104,(u=e.controlGroup)!=null?u:!1])),N)){let T=Object.keys((f=e.goals)!=null?f:{});for(let A=0;A<T.length;A++){let O=T[A];(v=g==null?void 0:g.visitorData.goals)!=null&&v[O]||c(this,P).emit("goalConverted",{goalId:O})}}};ct=function(){typeof document=="undefined"||!c(this,C).visitLifespan||(c(this,ne)&&window.clearTimeout(c(this,ne)),S(this,ne,window.setTimeout(()=>{this.data},c(this,C).visitLifespan+50)))};dt=function(e){let t=c(this,C).visitLifespan;return t?e.updated+t<Date.now():!1};Oe=function(e){var t,n;if(c(this,C).manifest)for(let i in e){let s=e[i],a=c(this,C).manifest.getDimensionByKey(i);a&&s>a.cap&&((n=(t=c(this,C)).onLogMessage)==null||n.call(t,["debug",110,{dim:i,score:s,cap:a.cap}]),e[i]=a.cap)}};Ae=function(){var e,t,n;return{...lt(),consent:(e=c(this,C).defaultConsent)!=null?e:!1,controlGroup:(n=(t=c(this,C).manifest)==null?void 0:t.rollForControlGroup())!=null?n:!1}};var un="contextual_editing_test",cn="contextual_editing_test_selected_variant",k,V,j,ee,U,te,b,R,we,Pe,_e,Ne,ft=class{constructor(e){_(this,R),F(this,"manifest"),_(this,k),_(this,V,{}),_(this,j),_(this,ee,{}),_(this,U),_(this,te),_(this,b,K()),F(this,"events",{on:c(this,b).on,off:c(this,b).off}),F(this,"storage");var t,n;let{manifest:i,...s}=e;S(this,j,{}),S(this,U,e.plugins),typeof e.transitionStore!="undefined"&&S(this,te,[]),(t=c(this,U))==null||t.forEach(a=>{a.logDrain&&c(this,b).on("log",a.logDrain)}),c(this,b).emit("log",["info",1,"GROUP"]);try{this.manifest=new Nt({onLogMessage:a=>c(this,b).emit("log",a),manifest:i,evaluator:new tt({CK:zt,QS:Mt,QK:qt,PVC:et,EVT:Vt,PV:$t})}),this.storage=new ln({...s,manifest:this.manifest,onServerTransitionReceived:a=>{S(this,k,a),a.ssv&&(S(this,V,a.ssv),c(this,b).emit("log",["debug",130,a]))},onLogMessage:a=>c(this,b).emit("log",a)}),this.storage.events.on("scoresUpdated",D(this,R,_e).bind(this)),c(this,k)||D(this,R,_e).call(this,this.storage.data),this.storage.events.on("quirksUpdated",a=>{let r=this.manifest.computeSignals({scores:c(this,V),state:c(this,j),previousState:c(this,j),visitor:this.storage.data});D(this,R,Pe).call(this,{quirks:a.quirks,scores:void 0}),this.storage.updateData(r),c(this,b).emit("quirksUpdated",a.quirks),c(this,b).emit("log",["info",4,a.quirks])}),(n=c(this,U))==null||n.forEach(a=>{a.init&&a.init(this)})}finally{c(this,b).emit("log",["info",1,"ENDGROUP"])}typeof window!="undefined"&&(window.__UNIFORM_CONTEXTUAL_EDITING_CONTEXT__=this)}get scores(){return c(this,V)}get quirks(){var e,t;return(t=(e=c(this,k))==null?void 0:e.quirks)!=null?t:this.storage.data.quirks}async update(e){var t,n,i,s,a;let r=[],o={};if((t=c(this,k))!=null&&t.quirks&&(e={...e,quirks:{...c(this,k).quirks,...e.quirks||{}}}),(n=c(this,k))!=null&&n.tests){let u=Object.entries(c(this,k).tests);if(u.length>0){let l=[];u.forEach(([d,f])=>{this.storage.data.tests[d]||(l.push([d,f]),o[d]=f)}),r.push(...l.map(([d,f])=>({type:"settest",data:{test:d,variant:f}})))}}(i=c(this,k))!=null&&i.personalizeVariants&&Object.keys(c(this,k).personalizeVariants).forEach(u=>{c(this,k).personalizeVariants[u].forEach(d=>{r.push({type:"setpersonalizecontrol",data:{personlizationName:u,index:d.index,control:d.control}})})});try{if(c(this,b).emit("log",["info",2,"GROUP",{...e,url:(s=e.url)==null?void 0:s.toString()}]),e.quirks&&r.push(...Object.entries(e.quirks).map(([u,l])=>({type:"setquirk",data:{key:u,value:l}}))),e.enrichments&&e.enrichments.forEach(u=>{let l=Ze(u.cat,u.key);this.manifest.getDimensionByKey(l)?r.push({type:"modscore",data:{dimension:l,delta:u.str}}):c(this,b).emit("log",["warn",5,u])}),r.push(...this.manifest.computeSignals({state:e,previousState:c(this,j),visitor:this.storage.data,scores:c(this,k)?D(this,R,Ne).call(this,this.storage.data):c(this,V)})),S(this,j,{...c(this,j),...e}),await this.storage.updateData(r),c(this,k)&&(await this.processServerCommands({serverCommands:c(this,k).commands,commands:r}),D(this,R,_e).call(this,this.storage.data),Object.entries(o).forEach(([u,l])=>{D(this,R,we).call(this,{name:u,variantId:l,variantAssigned:!0})}),S(this,k,void 0),c(this,b).emit("log",["debug",131])),c(this,U))for(let u=0;u<c(this,U).length;u++){let l=c(this,U)[u];l.update&&await l.update(e)}(a=c(this,te))==null||a.push(...r)}finally{c(this,b).emit("log",["info",2,"ENDGROUP"])}}async processServerCommands({serverCommands:e,commands:t}){if(!(e!=null&&e.length))return;let n=[];e.forEach(i=>{t.find(a=>Ht(a,i))||n.push(i)}),n.length>0&&await this.storage.updateData(n)}getTestVariantId(e){var t,n,i,s;let a=this.manifest.getTest(e);return a?(s=(i=a.wv)!=null?i:(n=(t=c(this,k))==null?void 0:t.tests)==null?void 0:n[e])!=null?s:this.storage.data.tests[e]:(c(this,b).emit("log",["warn",401,e]),null)}setTestVariantId(e,t){this.storage.updateData([{type:"settest",data:{test:e,variant:t}}])}getPersonalizeVariantControl(e,t){var n,i,s;let a=(i=(n=c(this,k))==null?void 0:n.personalizeVariants)!=null?i:this.storage.data.personalizeVariants,o=((s=a==null?void 0:a[e])!=null?s:[]).find(u=>u.index===t);return o==null?void 0:o.control}log(...e){c(this,b).emit("log",e)}test(e){var t,n,i;if(e.name===un)return{result:(t=e.variations.find(o=>{o.id}))!=null?t:e.variations.at(-1),variantAssigned:!1};let s=Qt({...e,context:this,onLogMessage:a=>c(this,b).emit("log",a)});return D(this,R,we).call(this,{name:e.name,variantId:(i=(n=s.result)==null?void 0:n.id)!=null?i:void 0,variantAssigned:s.variantAssigned}),s}personalize(e){let t=Bt({...e,context:this,onLogMessage:s=>c(this,b).emit("log",s)}),n=c(this,ee)[e.name],i={name:e.name,variantIds:t.variations.map(s=>({id:s.id||"Unknown",control:s.control})),control:this.storage.data.controlGroup,changed:!0};return n&&x(i.variantIds,n)&&(i.changed=!1),c(this,b).emit("personalizationResult",i),c(this,ee)[e.name]=i.variantIds,t}async forget(e){if(S(this,j,{}),c(this,U))for(let t=0;t<c(this,U).length;t++){let n=c(this,U)[t];n.forget&&await n.forget()}await this.storage.delete(e)}getServerToClientTransitionState(){let e={quirks:this.storage.data.quirks,ssv:c(this,V),tests:{},personalizeVariants:this.storage.data.personalizeVariants,commands:c(this,te)},t=this.storage.data.tests;return Object.entries(t).map(([n,i])=>{var s,a,r;((r=(a=(s=this.storage.options.transitionStore)==null?void 0:s.initialData)==null?void 0:a.tests)==null?void 0:r[n])!==t[n]&&e.tests&&(e.tests[n]=i)}),e}internal_processTestEvent(e){e.variantId&&(this.setTestVariantId(e.name,e.variantId),D(this,R,we).call(this,e))}internal_processPersonalizationEvent(e){c(this,ee)[e.name]=e.variantIds,c(this,b).emit("personalizationResult",e)}};k=new WeakMap;V=new WeakMap;j=new WeakMap;ee=new WeakMap;U=new WeakMap;te=new WeakMap;b=new WeakMap;R=new WeakSet;we=function(e){c(this,b).emit("testResult",e)};Pe=async function(e){let t=this.manifest.computeGoals(e);t.length!==0&&await this.storage.updateData(t)};_e=function(e){let t=D(this,R,Ne).call(this,e);!x(t,c(this,V))&&(S(this,V,t),D(this,R,Pe).call(this,{scores:c(this,V),quirks:void 0}),c(this,b).emit("scoresUpdated",t),c(this,b).emit("log",["info",3,t]))};Ne=function(e){var t;let n={...e.scores};for(let i in e.sessionScores)n[i]=((t=n[i])!=null?t:0)+e.sessionScores[i];return n=this.manifest.computeAggregateDimensions(n),n};var Jn=(0,ht.default)();var Xn=(0,pt.default)();var vt=L($e(),1),yn=({manifest:e,request:t,options:n={}})=>new ft({manifest:e,transitionStore:new wn({request:t}),...n}),wn=class extends st{constructor({request:e,...t}){var n,i;super({...t,serverCookieValue:e?(0,vt.parse)((n=e.headers.get("cookie"))!=null?n:"")[(i=t.cookieName)!=null?i:Ue]:void 0})}},_n=91,Sn=93,bn=44,Dn=60,Cn=10,En={"&gt;":">","&lt;":"<"},In={op:!0},Ve=e=>{e&&typeof e=="object"&&Object.keys(e).forEach(t=>{let n=e[t];if(In[t]&&typeof n=="string"){let i=En[n];e[t]=i||n}else typeof n=="object"?Ve(n):Array.isArray(n)&&n.forEach(i=>{Ve(i)})})},gt=(e,t)=>{let n=[_n];t.forEach((s,a)=>{a>0&&n.push(bn),n.push(...s)}),n.push(Sn);let i=JSON.parse(e.decode(new Uint8Array(n)));return Array.isArray(i)&&i.forEach(s=>{Ve(s)}),i},kn=({list:e,decoder:t,context:n})=>{let i=[],s,a=[],r=[],o=[];for(let p=0;p<e.fragments.length;p++){let h=e.fragments[p];if(h.type==="list-start")s=h;else if(h.type==="item-settings")a.push(h);else if(h.type==="item-html"){if(!r.length&&h.notablePieces)for(let y of h.notablePieces)y.type==="emotion-style"&&o.push(y);r.push({listIndex:p})}}if(a.length!==r.length)throw new Error("Item settings and HTML mismatch");if(!s)throw new Error("List settings are missing");let[u,...l]=gt(t,[s.content,...a.map(p=>p.content)]),d=u,f=n.personalize({...d,variations:l.map((p,h)=>{let y=r[h];return{...p,...y}})}),v=[],g=0;for(let p=0;p<e.fragments.length;p++){let h=e.fragments[p];if(h.type==="text")v.push(...h.content);else if(h.type==="item-html"){let y=f.variations[g];if(typeof y!="undefined"){h.evaluated&&i.push(...h.evaluated);let I=e.fragments[y.listIndex];if(!I)throw new Error("Invalid HTML index");let m=[];if(o.length&&y.listIndex!==r[0].listIndex&&m.push(...o),I.notablePieces)for(let N of I.notablePieces)N.type==="emotion-style"&&m.push(N);if(m.length){for(let N of m)v.push(...N.content);o.length=0}v.push(...I.content)}++g}}return{references:i,personalizationName:d.name,bytes:v}},xn=({test:e,decoder:t,context:n})=>{let i=[],s,a=[],r=[],o=[];for(let p=0;p<e.fragments.length;p++){let h=e.fragments[p];if(h.type==="test-start")s=h;else if(h.type==="item-settings")a.push(h);else if(h.type==="item-html"){if(!r.length&&h.notablePieces)for(let y of h.notablePieces)y.type==="emotion-style"&&o.push(y);r.push({listIndex:p})}}if(a.length!==r.length)throw new Error("Item settings and HTML mismatch");if(!s)throw new Error("List settings are missing");let[u,...l]=gt(t,[s.content,...a.map(p=>p.content)]),d=u,f=n.test({...d,name:d.name,variations:l.map((p,h)=>{let y=r[h];return{id:p.id,...y}})}),v=[],g;for(let p=0;p<e.fragments.length;p++){let h=e.fragments[p];if(h.type==="text")v.push(...h.content);else if(h.type==="item-html"&&!g&&f.result){let y=e.fragments[f.result.listIndex];if(!y)throw new Error("Invalid HTML index");y.evaluated&&i.push(...y.evaluated);let I=[];if(o.length&&f.result.listIndex!==r[0].listIndex&&I.push(...o),y.notablePieces)for(let m of y.notablePieces)m.type==="emotion-style"&&I.push(m);if(I.length){for(let m of I)v.push(...m.content);v.push(Cn)}v.push(...y.content),g=f.result.id}}return{bytes:v,selectedId:g,testName:d.name,references:i}},Tn=()=>{let e={"list-start":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,115,116,97,114,116,34,62],count:0},"item-settings":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,105,116,101,109,45,115,101,116,116,105,110,103,115,34,62],count:0},"item-html":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,105,116,101,109,45,104,116,109,108,34,62],count:0},"list-end":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,101,110,100,34,62],count:0},"end-tag":{pattern:[60,47,110,101,115,105,116,97,103,62],count:0},"test-start":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,116,101,115,116,45,115,116,97,114,116,34,62],count:0},"test-end":{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,116,101,115,116,45,101,110,100,34,62],count:0},"page-state":{pattern:[60,115,99,114,105,112,116,32,105,100,61,34,95,95,85,78,73,70,79,82,77,95,68,65,84,65,95,95,34,32,116,121,112,101,61,34,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110,34,62],count:0},"end-script-tag":{pattern:[60,47,115,99,114,105,112,116,62],count:0},"emotion-style-tag":{pattern:[60,115,116,121,108,101,32,100,97,116,97,45,101,109,111,116,105,111,110,61],count:0},"end-style-tag":{pattern:[60,47,115,116,121,108,101,62],count:0}},t={},n={},i=Object.keys(e);for(let s=0;s<i.length;s++){let a=i[s],r=e[a],o=r.pattern[1],u=r.pattern[2];typeof o!="undefined"&&(t[o]=!0),typeof u!="undefined"&&(n[u]=!0)}return{state:e,stateKeys:i,secondCharacters:t,thirdCharacters:n}},On=({writer:e})=>{let t=!0,n=[];return{length:()=>n.length,add:i=>{t&&(typeof i=="number"?n.push(i):n.push(...i))},write:()=>{e.write(new Uint8Array(n))},disable:()=>{t=!1},enable:()=>{t=!0},get:()=>n}},An=({value:e,state:t,patternState:n,sections:i,writeBuffer:s,encoder:a,decoder:r,context:o,pageTestState:u,options:l})=>{let{stateKeys:d}=n;if(e)for(let f=0;f<e.length;f++){let v=e[f],g=!1;(t.activeSearchers||v===Dn&&(f+1>=e.length||n.secondCharacters[e[f+1]])&&(f+2>=e.length||n.thirdCharacters[e[f+2]]))&&d.forEach(p=>{var h,y,I;let m=n.state[p],N=m.pattern[m.count];if(v===N)m.count===0&&++t.activeSearchers,g=!0,++m.count;else if(m.count){if(--t.activeSearchers,!t.activeSearchers)for(let w=0;w<m.count;w++)t.currentFragment?t.currentFragment.content.push(m.pattern[w]):s.add(m.pattern[w]);m.count=0}if(m.count===m.pattern.length)if(--t.activeSearchers,m.count=0,g=!0,p==="end-tag"){let w=!0,T,A=[];if(((h=t.currentFragment)==null?void 0:h.type)==="list-end"){let O=i.shift(),{bytes:z,references:se,personalizationName:re}=kn({list:O,decoder:r,context:o});re&&A.push({type:"personalization",name:re}),A.push(...se),T=z}else if(((y=t.currentFragment)==null?void 0:y.type)==="test-end"){let O=i.shift(),{testName:z,selectedId:se,bytes:re,references:_t}=xn({test:O,decoder:r,context:o});se&&(u[z]=se,A.push({type:"test",name:z}),A.push(..._t)),T=re}if(T!=null&&T.length){let[O]=i;if(O){let z=O.fragments[O.fragments.length-1];z.content.push(...T),t.currentFragment=z,t.currentFragment.evaluated.push(...A),w=!1}else t.writtenEvaluations.push(...A),s.add(T)}w&&(t.currentFragment=void 0)}else if(p==="page-state"){let w=o.getServerToClientTransitionState();w.tests&&Object.keys(w.tests).forEach(O=>{t.writtenEvaluations.find(z=>z.type==="test"&&z.name===O)||delete w.tests[O]});let T=JSON.stringify(w),A=a.encode(T);s.add(n.state["page-state"].pattern),s.add([].slice.call(A)),s.disable()}else if(p==="end-script-tag"){let[w]=i;w?w.fragments[w.fragments.length-1].content.push(...n.state["end-script-tag"].pattern):(s.enable(),s.add(n.state["end-script-tag"].pattern))}else if(p==="emotion-style-tag")if(l!=null&&l.emotion)if(((I=t.currentFragment)==null?void 0:I.type)==="item-html"){let w={type:"emotion-style",content:[...n.state["emotion-style-tag"].pattern]};t.currentFragment.notablePieces=t.currentFragment.notablePieces||[],t.currentFragment.notablePieces.push(w),t.currentNotablePiece=w}else s.add(n.state["emotion-style-tag"].pattern);else s.add(n.state["emotion-style-tag"].pattern);else if(p==="end-style-tag")l!=null&&l.emotion&&t.currentNotablePiece?(t.currentNotablePiece.content.push(...n.state["end-style-tag"].pattern),t.currentNotablePiece=void 0):s.add(n.state["end-style-tag"].pattern);else{let w={content:[],type:p,evaluated:[]};if(t.currentFragment=w,w.type==="list-start"||w.type==="test-start")i.unshift({fragments:[w]});else{let[T]=i;if(!T)throw new Error("Not in a list!");T.fragments.push(w)}}}),g||(i.length&&!t.currentFragment&&(t.currentFragment={content:[],type:"text",evaluated:[]},i[0].fragments.push(t.currentFragment)),t.currentFragment?t.currentNotablePiece?t.currentNotablePiece.content.push(v):t.currentFragment.content.push(v):s.add(v))}},Rn=({reader:e,state:t,patternState:n,sections:i,writeBuffer:s,encoder:a,decoder:r,context:o,pageTestState:u,options:l})=>new Promise(d=>{let f=()=>{e.read().then(({done:v,value:g})=>{An({value:g,state:t,patternState:n,sections:i,writeBuffer:s,encoder:a,decoder:r,context:o,pageTestState:u,options:l}),v?d():f()})};f()}),Un=({reader:e,writer:t,encoder:n,decoder:i,context:s,options:a})=>{let r=Tn(),o={},u=[],l=On({writer:t});return Rn({reader:e,decoder:i,encoder:n,context:s,pageTestState:o,patternState:r,sections:u,state:{activeSearchers:0,currentFragment:void 0,currentNotablePiece:void 0,writtenEvaluations:[]},writeBuffer:l,options:a}).then(()=>{l.length()&&l.write()}).then(t.close)},mt=()=>async({response:e,context:t,encoder:n,decoder:i,options:s})=>{let a=e.headers.get("Content-Type");if(!(a!=null&&a.includes("text/html")&&e.body))return{processed:!1,response:e};let{readable:r,writable:o}=new TransformStream,u=new Response(r,e),l=e.body.getReader(),d=o.getWriter();return Un({context:t,decoder:i,encoder:n,reader:{read:async()=>{let{done:f,value:v}=await l.read();return{done:f,value:v}}},writer:{write:f=>{d.write(f)},close:()=>d.close()},options:s}),{processed:!0,response:u}};var yt=L($e()),fi=()=>async({request:e,response:t,context:n,quirks:i})=>(await n.update({cookies:(0,yt.parse)(e.headers.get("cookie")||""),url:new URL(e.url),quirks:i}),await mt()({context:n,response:t,encoder:new TextEncoder,decoder:new TextDecoder}));var Pn=(a=>(a.CountryCode="ntl-country-code",a.CountryName="ntl-country-name",a.SubdivisionCode="ntl-subdiv-code",a.SubdivisionName="ntl-subdiv-name",a.City="ntl-city",a))(Pn||{});var wt={missingQuirkValue:"unknown",geo:{country:{code:!0},subdivision:{code:!0},city:!0}},vi=(e,t=wt)=>{var a,r,o,u,l,d,f,v,g,p,h,y,I,m;let n=t==null?void 0:t.geo;if(!n)return{};let i=(a=t.missingQuirkValue)!=null?a:wt.missingQuirkValue,s={};return(r=n.country)!=null&&r.code&&(s["ntl-country-code"]=(u=(o=e.geo.country)==null?void 0:o.code)!=null?u:i),(l=n.country)!=null&&l.name&&(s["ntl-country-name"]=(f=(d=e.geo.country)==null?void 0:d.name)!=null?f:i),(v=n.subdivision)!=null&&v.code&&(s["ntl-subdiv-code"]=(p=(g=e.geo.subdivision)==null?void 0:g.code)!=null?p:i),(h=n.subdivision)!=null&&h.name&&(s["ntl-subdiv-name"]=(I=(y=e.geo.subdivision)==null?void 0:y.name)!=null?I:i),n.city&&(s["ntl-city"]=(m=e.geo.city)!=null?m:i),s};export{Pn as NetlifyQuirks,vi as buildNetlifyQuirks,yn as createEdgeContext,fi as createUniformEdgeHandler};
/*! Bundled license information:

cookie/index.js:
  (*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

js-cookie/dist/js.cookie.mjs:
  (*! js-cookie v3.0.5 | MIT *)
*/
